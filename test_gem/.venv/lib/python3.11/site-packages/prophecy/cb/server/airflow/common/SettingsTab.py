from prophecy.cb.ui.uispec import *

def settings_field_picker() -> FieldPicker:
    return FieldPicker(height="100%", propertyVar="component.settings") \
        .addField(TextBox("Emails to notify", placeholder=""), "email") \
        .addField(Checkbox("Email On Failure"), "email_on_failure") \
        .addField(Checkbox("Email On Retry"), "email_on_retry") \
        .addField(
        NumberBox(
            titleVar="Number of retries",
            minValueVar=0,
            maxValueVar=10000000,
            placeholder="0"
        ),
        "retries",
    ) \
        .addField(
        NumberBox(
            titleVar="Retry Delay (in minutes)",
            minValueVar=0,
            maxValueVar=10000000,
            placeholder="0",
        ),
        "retry_delay",
    ) \
        .addField(
        Checkbox("Retry Exponential Backoff"),
        "retry_exponential_backoff",
    ) \
        .addField(
        NumberBox(
            titleVar="Max Retry Delay (in minutes)",
            minValueVar=0,
            maxValueVar=10000000,
            placeholder="0",
        ),
        "max_retry_delay",
    ) \
        .addField(
        NumberBox(
            titleVar="Execution Timeout (in seconds)",
            minValueVar=0,
            maxValueVar=604800,  # 7 days in seconds
            placeholder="0",
        ),
        "execution_timeout_int",
    ) \
        .addField(
        SelectBox("Trigger Rule")
        .addOption("All Success", "all_success")
        .addOption("All Failure", "all_failed")
        .addOption("All Done", "all_done")
        .addOption("All Skipped", "all_skipped")
        .addOption("One Success", "one_success")
        .addOption("One Failed", "one_failed")
        .addOption("One Done", "one_done")
        .addOption("None Failed", "none_failed")
        .addOption("None Skipped", "none_skipped")
        .addOption("None Failed Or Skipped", "none_failed_or_skipped")
        .addOption("Dummy", "dummy")
        .addOption("Always", "always")
        .withDefault("all_success"),
        "trigger_rule",
    ) \
        .addField(Checkbox("Depends On Past"), "depends_on_past") \
        .addField(
        Checkbox("Ignore First Depends On Past"),
        "ignore_first_depends_on_past",
    ) \
        .addField(Checkbox("Wait For Downstream"), "wait_for_downstream") \
        .addField(
        NumberBox(
            titleVar="Priority Weight",
            minValueVar=0,
            maxValueVar=10000000,
            placeholder="0",
        ),
        "priority_weight",
    ) \
        .addField(
        SelectBox("Weight Rule")
        .addOption("downstream", "downstream")
        .addOption("upstream", "upstream")
        .addOption("absolute", "absolute")
        .withDefault("downstream"),
        "weight_rule",
    ) \
        .addField(TextBox("Queue", placeholder=""), "queue") \
        .addField(TextBox("Pool", placeholder=""), "pool") \
        .addField(
        NumberBox(
            titleVar="Pool Slots",
            minValueVar=0,
            maxValueVar=10000000,
            placeholder="0",
        ),
        "pool_slots",
    ) \
        .addField(
        NumberBox(
            titleVar="Max Active TIs Per Dag",
            minValueVar=0,
            maxValueVar=10000000,
            placeholder="0",
        ),
        "max_active_tis_per_dag",
    ) \
        .addField(Checkbox("Capture gem output(XCom Push)"), "do_xcom_push") \
        .addField(TextBox("Run As User", placeholder=""), "run_as_user")

def tab_spec() -> TabPane:
    return TabPane("Settings", "setting").addElement(
        StackLayout(height="100%").addElement(
            StackItem(grow=1).addElement(
                StackLayout(align="space-vacant", height="100%").addElement(
                    settings_field_picker()
                )
            )
        )
    )
