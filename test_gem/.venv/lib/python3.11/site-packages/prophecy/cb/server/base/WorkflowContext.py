from abc import ABC, ABCMeta
from typing import List

from prophecy.cb.util.config import Configuration
from prophecy.cb.util.functions import BusinessRule


class WorkflowContextElement(metaclass=ABCMeta):
    pass

class ConfigurationContext(WorkflowContextElement):
    def __init__(self, config: Configuration, default_config: Configuration, **kwargs):
        self.config = config
        self.default_config = default_config

    def get_field_names(self):
        return self.config.get_config_field_names()

class FunctionsContext(WorkflowContextElement):
    def __init__(self, rules: List[BusinessRule], **kwargs):
        self.rules = rules
        pass

class WorkflowContext(metaclass=ABCMeta):
    def config_context(self) -> ConfigurationContext:
        pass
    def functions_context(self) -> FunctionsContext:
        pass

class EmptyWorkflowContext(WorkflowContext):
    pass

class ValidateSchemaWorkflowContext(WorkflowContext):
    pass

# Add fields with default values to this workflow context only.
# Same workflow context should be passed to gem in all cases.
class ComponentWorkflowContext(WorkflowContext):
    def __init__(self, config_context: ConfigurationContext, functions_context: FunctionsContext=None, **kwargs):
        self.config_context = config_context
        self.functions_context = functions_context
        pass