from prophecy.cb.server.base.ComponentBuilderBase import *
from pyspark.sql import *
from pyspark.sql.functions import *

from typing import *
from prophecy.cb.server.base.datatypes import SInt
from prophecy.cb.ui.uispec import *
from prophecy.cb.server.base.WorkflowContext import WorkflowContext

class ControlFlowInput(ComponentSpec):
    name: str = "ControlFlowInput"
    category: str = "Custom"
    gemDescription: str = "This node specifies the input ports of ControlFlow gem."
    docUrl: str = ""

    def optimizeCode(self) -> bool:
        return True

    @dataclass(frozen=True)
    class ControlFlowInputProperties(ComponentProperties):
        description: str = ""
        minNumberOfInPorts: Optional[int] = None
        allowInportRename: Optional[bool] = None
        allowInportAddDelete: Optional[bool] = None
        minNumberOfOutPorts: Optional[int] = None
        allowOutportRename: Optional[bool] = None
        allowOutportAddDelete: Optional[bool] = None

    def dialog(self) -> Dialog:
        return Dialog("ControlFlowInput").addElement(
            ColumnsLayout(gap="1rem", height="100%")
            .addColumn(
                Ports(
                    minInputPorts="minNumberOfInPorts",
                    allowInputRename="allowInportRename",
                    allowInputAddOrDelete="allowInportAddDelete",
                    minOutputPorts="minNumberOfOutPorts",
                    allowOutputRename="allowOutportRename",
                    allowOutputAddOrDelete="allowOutportAddDelete"
                ), "content")
        )

    def validate(self, context: WorkflowContext, component: Component[ControlFlowInputProperties]) -> List[Diagnostic]:
        return []

    def onChange(self, context: WorkflowContext, oldState: Component[ControlFlowInputProperties], newState: Component[ControlFlowInputProperties]) -> Component[
        ControlFlowInputProperties]:
        return newState


    class ControlFlowInputCode(ComponentCode):
        def __init__(self, newProps):
            self.props: ControlFlowInput.ControlFlowInputProperties = newProps

        def apply(self, spark: SparkSession, in0: DataFrame) -> DataFrame:
            return in0