from prophecy.cb.server.base.ComponentBuilderBase import *
from pyspark.sql import *
from pyspark.sql.functions import *

from prophecy.cb.server.base.datatypes import SInt
from prophecy.cb.ui.uispec import *
from prophecy.cb.server.base.WorkflowContext import WorkflowContext

class ControlFlowOutput(ComponentSpec):
    name: str = "ControlFlowOutput"
    category: str = "Custom"
    gemDescription: str = "This node specifies the output ports of the ControlFlow component."
    docUrl: str = ""

    def optimizeCode(self) -> bool:
        return True

    @dataclass(frozen=True)
    class ControlFlowOutputProperties(ComponentProperties):
        description: str = ""
        minNumberOfInPorts: Optional[int] = None
        allowInportRename: Optional[bool] = None
        allowInportAddDelete: Optional[bool] = None
        minNumberOfOutPorts: Optional[int] = None
        allowOutportRename: Optional[bool] = None
        allowOutportAddDelete: Optional[bool] = None

    def dialog(self) -> Dialog:
        return Dialog("ControlFlowOutput").addElement(
            ColumnsLayout(gap="1rem", height="100%")
            .addColumn(Ports(
                minInputPorts="minNumberOfInPorts",
                allowInputRename="allowInportRename",
                allowInputAddOrDelete="allowInportAddDelete",
                minOutputPorts="minNumberOfOutPorts",
                allowOutputRename="allowOutportRename",
                allowOutputAddOrDelete="allowOutportAddDelete"
            ), "content")
        )

    def validate(self, context: WorkflowContext, component: Component[ControlFlowOutputProperties]) -> List[Diagnostic]:
        return []

    def onChange(self, context: WorkflowContext, oldState: Component[ControlFlowOutputProperties], newState: Component[ControlFlowOutputProperties]) -> Component[
        ControlFlowOutputProperties]:
        return newState


    class ControlFlowOutputCode(ComponentCode):
        def __init__(self, newProps):
            self.props: ControlFlowOutput.ControlFlowOutputProperties = newProps

        def apply(self, spark: SparkSession, in0: DataFrame) -> DataFrame:
            return in0